<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Placeholder Designer</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-panel: #12121a;
            --bg-surface: #1a1a24;
            --bg-hover: #24243a;
            --border: #2a2a3d;
            --border-active: #4a4a6d;
            --text-primary: #f0f0f5;
            --text-secondary: #8888a0;
            --text-muted: #5555668;
            --accent: #6366f1;
            --accent-hover: #818cf8;
            --accent-muted: #4f46e5;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --grid-line: rgba(99, 102, 241, 0.08);
            --grid-line-major: rgba(99, 102, 241, 0.15);
            --widget-bg: rgba(99, 102, 241, 0.12);
            --widget-border: rgba(99, 102, 241, 0.4);
            --widget-hover: rgba(99, 102, 241, 0.2);
            --layout-widget-bg: rgba(34, 197, 94, 0.12);
            --layout-widget-border: rgba(34, 197, 94, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Left Panel - Project Tree */
        .left-panel {
            width: 280px;
            min-width: 280px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .tree-container {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .tree-section {
            margin-bottom: 16px;
        }

        .tree-section-header {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .tree-section-header:hover {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .tree-section-header .icon {
            margin-right: 8px;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .tree-section-header.collapsed .icon {
            transform: rotate(-90deg);
        }

        .tree-section-header .add-btn {
            margin-left: auto;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.15s;
        }

        .tree-section-header .add-btn:hover {
            background: var(--accent);
            color: white;
        }

        .tree-items {
            padding-left: 8px;
        }

        .tree-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.15s;
            margin: 2px 0;
        }

        .tree-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .tree-item.active {
            background: var(--accent-muted);
            color: white;
        }

        .tree-item .item-icon {
            margin-right: 10px;
            font-size: 14px;
            opacity: 0.7;
        }

        .tree-item .item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tree-item .item-actions {
            display: none;
            gap: 4px;
        }

        .tree-item:hover .item-actions {
            display: flex;
        }

        .item-action-btn {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.15s;
        }

        .item-action-btn:hover {
            background: var(--bg-surface);
            color: var(--text-primary);
        }

        .item-action-btn.danger:hover {
            background: var(--danger);
            color: white;
        }

        /* Main Editor Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-dark);
            overflow: hidden;
        }

        /* Toolbar */
        .toolbar {
            height: 52px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0 12px;
            border-right: 1px solid var(--border);
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-left: auto;
        }

        .toolbar-btn {
            height: 34px;
            padding: 0 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .toolbar-btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-active);
            color: var(--text-primary);
        }

        .toolbar-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .toolbar-btn.primary:hover {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        .toolbar-btn.active {
            background: var(--accent-muted);
            border-color: var(--accent);
            color: white;
        }

        .toolbar-select {
            height: 34px;
            padding: 0 12px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            min-width: 150px;
        }

        .toolbar-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .toolbar-input {
            height: 34px;
            padding: 0 12px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            border-radius: 6px;
            width: 60px;
            text-align: center;
        }

        .toolbar-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .toolbar-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Canvas Container */
        .canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            padding: 40px;
            background: 
                radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.03) 0%, transparent 70%),
                var(--bg-dark);
        }

        .canvas-wrapper {
            position: relative;
            background: var(--bg-surface);
            border-radius: 12px;
            box-shadow: 
                0 0 0 1px var(--border),
                0 20px 60px -20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .canvas-wrapper.phone {
            width: 375px;
            height: 667px;
        }

        .canvas-wrapper.kiosk {
            width: 1080px;
            height: 1920px;
            transform: scale(0.4);
            transform-origin: center center;
        }

        .canvas-wrapper.fit-screen {
            transform: scale(var(--fit-scale, 1));
        }

        .canvas {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--bg-panel);
        }

        /* Grid Overlay */
        .grid-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: 0.5;
        }

        .grid-overlay.hidden {
            opacity: 0;
        }

        /* Widget */
        .widget {
            position: absolute;
            background: var(--widget-bg);
            border: 2px dashed var(--widget-border);
            border-radius: 6px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
            text-align: center;
            padding: 8px;
            transition: border-color 0.15s, background 0.15s;
            overflow: hidden;
        }

        .widget:hover {
            background: var(--widget-hover);
            border-color: var(--accent);
        }

        .widget.selected {
            border-style: solid;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .widget.layout-widget {
            background: var(--layout-widget-bg);
            border-color: var(--layout-widget-border);
            cursor: default;
            opacity: 0.7;
        }

        .widget.layout-widget:hover {
            background: var(--layout-widget-bg);
            border-color: var(--layout-widget-border);
        }

        .widget-label {
            word-break: break-word;
            line-height: 1.3;
        }

        /* Widget Toolbar */
        .widget-toolbar {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            align-items: center;
            gap: 4px;
            padding: 6px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }

        .widget.selected .widget-toolbar {
            display: flex;
        }

        .widget-tool-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.15s;
        }

        .widget-tool-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .widget-tool-btn.danger:hover {
            background: var(--danger);
            color: white;
        }

        /* Resize Handles */
        .resize-handle {
            position: absolute;
            background: var(--accent);
            border-radius: 2px;
            z-index: 10;
        }

        .resize-handle.hidden {
            display: none;
        }

        .resize-handle-n, .resize-handle-s {
            height: 6px;
            left: 20%;
            right: 20%;
            cursor: ns-resize;
        }

        .resize-handle-n { top: -3px; }
        .resize-handle-s { bottom: -3px; }

        .resize-handle-e, .resize-handle-w {
            width: 6px;
            top: 20%;
            bottom: 20%;
            cursor: ew-resize;
        }

        .resize-handle-e { right: -3px; }
        .resize-handle-w { left: -3px; }

        .resize-handle-nw, .resize-handle-ne, .resize-handle-sw, .resize-handle-se {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .resize-handle-nw { top: -5px; left: -5px; cursor: nwse-resize; }
        .resize-handle-ne { top: -5px; right: -5px; cursor: nesw-resize; }
        .resize-handle-sw { bottom: -5px; left: -5px; cursor: nesw-resize; }
        .resize-handle-se { bottom: -5px; right: -5px; cursor: nwse-resize; }

        /* Confirm Dialog */
        .confirm-popup {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            z-index: 200;
            display: none;
        }

        .confirm-popup.show {
            display: block;
        }

        .confirm-popup-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .confirm-popup-btns {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 6px 16px;
            font-size: 12px;
            font-weight: 500;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .confirm-btn.yes {
            background: var(--danger);
            color: white;
        }

        .confirm-btn.yes:hover {
            background: #dc2626;
        }

        .confirm-btn.no {
            background: var(--bg-surface);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .confirm-btn.no:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        /* Rename Input */
        .rename-container {
            position: absolute;
            top: -120px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            z-index: 200;
            width: 280px;
            display: none;
        }

        .rename-container.show {
            display: block;
        }

        .rename-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .rename-input {
            width: 100%;
            height: 36px;
            padding: 0 12px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 13px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .rename-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .rename-suggestions {
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .suggestion-group {
            margin-bottom: 8px;
        }

        .suggestion-group-title {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-muted);
            padding: 4px 8px;
        }

        .suggestion-item {
            padding: 6px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.15s;
        }

        .suggestion-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .rename-btns {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .rename-btn {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .rename-btn.save {
            background: var(--accent);
            color: white;
        }

        .rename-btn.save:hover {
            background: var(--accent-hover);
        }

        .rename-btn.cancel {
            background: var(--bg-surface);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .rename-btn.cancel:hover {
            background: var(--bg-hover);
        }

        /* Drawing Box */
        .drawing-box {
            position: absolute;
            border: 2px dashed var(--accent);
            background: rgba(99, 102, 241, 0.1);
            pointer-events: none;
            z-index: 50;
            display: none;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            min-width: 400px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            height: 40px;
            padding: 0 12px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            border-radius: 6px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            border-radius: 6px;
            resize: vertical;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .modal-btn.primary {
            background: var(--accent);
            color: white;
        }

        .modal-btn.primary:hover {
            background: var(--accent-hover);
        }

        .modal-btn.secondary {
            background: var(--bg-surface);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .modal-btn.secondary:hover {
            background: var(--bg-hover);
        }

        /* Status Bar */
        .status-bar {
            height: 28px;
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted);
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-active);
        }

        /* File Input Hidden */
        .hidden-input {
            display: none;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Left Panel -->
        <div class="left-panel">
            <div class="panel-header">
                <span class="panel-title">üìÅ Project</span>
            </div>
            <div class="tree-container">
                <!-- Layouts Section -->
                <div class="tree-section">
                    <div class="tree-section-header" data-section="layouts">
                        <span class="icon">‚ñº</span>
                        <span>Layouts</span>
                        <button class="add-btn" onclick="createNewLayout()" title="New Layout">+</button>
                    </div>
                    <div class="tree-items" id="layouts-tree"></div>
                </div>

                <!-- Screens Section -->
                <div class="tree-section">
                    <div class="tree-section-header" data-section="screens">
                        <span class="icon">‚ñº</span>
                        <span>Screens</span>
                        <button class="add-btn" onclick="createNewScreen()" title="New Screen">+</button>
                    </div>
                    <div class="tree-items" id="screens-tree"></div>
                </div>

                <!-- Components Library -->
                <div class="tree-section">
                    <div class="tree-section-header collapsed" data-section="components">
                        <span class="icon">‚ñº</span>
                        <span>Components</span>
                    </div>
                    <div class="tree-items" id="components-tree" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Main Area -->
        <div class="main-area">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <select class="toolbar-select" id="current-item-select" onchange="selectItem(this.value)">
                        <option value="">-- Select --</option>
                    </select>
                </div>

                <div class="toolbar-group">
                    <span class="toolbar-label">Grid:</span>
                    <input type="number" class="toolbar-input" id="grid-cols" value="64" min="1" max="200" onchange="updateGridSize()">
                    <span class="toolbar-label">√ó</span>
                    <input type="number" class="toolbar-input" id="grid-rows" value="36" min="1" max="200" onchange="updateGridSize()">
                    <button class="toolbar-btn" id="toggle-grid-btn" onclick="toggleGrid()">
                        <span>‚äû</span> Grid
                    </button>
                </div>

                <div class="toolbar-group">
                    <span class="toolbar-label">Device:</span>
                    <select class="toolbar-select" id="device-select" onchange="changeDevice(this.value)" style="min-width: 100px;">
                        <option value="phone">Phone</option>
                        <option value="kiosk">Kiosk</option>
                        <option value="custom">Custom</option>
                    </select>
                    <button class="toolbar-btn" onclick="fitToScreen()" title="Fit to Screen">
                        <span>‚§¢</span>
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="showImportModal()">
                        <span>üì•</span> Import
                    </button>
                    <button class="toolbar-btn" onclick="copyCurrentJSON()">
                        <span>üìã</span> Copy JSON
                    </button>
                    <button class="toolbar-btn primary" onclick="exportProject()">
                        <span>üíæ</span> Export
                    </button>
                </div>
            </div>

            <!-- Canvas -->
            <div class="canvas-container" id="canvas-container">
                <div class="canvas-wrapper phone" id="canvas-wrapper">
                    <div class="canvas" id="canvas">
                        <svg class="grid-overlay" id="grid-overlay"></svg>
                        <div class="drawing-box" id="drawing-box"></div>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <span class="status-item" id="status-mode">Mode: Edit Screen</span>
                <span class="status-item" id="status-grid">Grid: 64√ó36</span>
                <span class="status-item" id="status-widgets">Widgets: 0</span>
                <span class="status-item" id="status-pos">Pos: 0, 0</span>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal">
            <div class="modal-title">Import JSON</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Import Type</label>
                    <select class="form-input" id="import-type">
                        <option value="screen">Screen</option>
                        <option value="layout">Layout</option>
                        <option value="project">Full Project</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">JSON Data</label>
                    <textarea class="form-textarea" id="import-json" placeholder="Paste JSON here..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Or upload file</label>
                    <input type="file" accept=".json" class="form-input" id="import-file" onchange="handleFileImport(event)">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeImportModal()">Cancel</button>
                <button class="modal-btn primary" onclick="importJSON()">Import</button>
            </div>
        </div>
    </div>

    <!-- New Screen Modal -->
    <div class="modal-overlay" id="new-screen-modal">
        <div class="modal">
            <div class="modal-title">New Screen</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Screen ID</label>
                    <input type="text" class="form-input" id="new-screen-id" placeholder="e.g., home, settings, profile">
                </div>
                <div class="form-group">
                    <label class="form-label">Screen Name</label>
                    <input type="text" class="form-input" id="new-screen-name" placeholder="e.g., Home Screen">
                </div>
                <div class="form-group">
                    <label class="form-label">Base Layout</label>
                    <select class="form-input" id="new-screen-layout">
                        <option value="">-- No Layout (Default) --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Scroll Type</label>
                    <select class="form-input" id="new-screen-scroll">
                        <option value="fixed">Fixed</option>
                        <option value="scrollable">Scrollable</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeNewScreenModal()">Cancel</button>
                <button class="modal-btn primary" onclick="saveNewScreen()">Create</button>
            </div>
        </div>
    </div>

    <!-- New Layout Modal -->
    <div class="modal-overlay" id="new-layout-modal">
        <div class="modal">
            <div class="modal-title">New Layout</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Layout ID</label>
                    <input type="text" class="form-input" id="new-layout-id" placeholder="e.g., main, minimal, fullscreen">
                </div>
                <div class="form-group">
                    <label class="form-label">Layout Name</label>
                    <input type="text" class="form-input" id="new-layout-name" placeholder="e.g., Main Layout">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="closeNewLayoutModal()">Cancel</button>
                <button class="modal-btn primary" onclick="saveNewLayout()">Create</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // DATA STRUCTURES
        // ============================================
        
        let projectData = {
            name: "Untitled Project",
            gridCols: 64,
            gridRows: 36,
            device: "phone",
            layouts: {},
            screens: {},
            components: {
                header: [],
                footer: [],
                navigation: [],
                button: [],
                card: [],
                other: []
            }
        };

        let currentMode = 'screen'; // 'screen' or 'layout'
        let currentItemId = null;
        let selectedWidgetId = null;
        let isDrawing = false;
        let drawStart = { x: 0, y: 0 };
        let isDragging = false;
        let isResizing = false;
        let resizeDirection = null;
        let dragOffset = { x: 0, y: 0 };
        let showGrid = true;
        let widgetIdCounter = 0;

        // ============================================
        // INITIALIZATION
        // ============================================

        function init() {
            // Create default layout
            projectData.layouts['default'] = {
                id: 'default',
                name: 'Default Layout',
                widgets: []
            };

            // Create default screen
            projectData.screens['home'] = {
                id: 'home',
                name: 'Home Screen',
                layoutId: 'default',
                scrollType: 'fixed',
                widgets: []
            };

            currentItemId = 'home';
            currentMode = 'screen';

            updateProjectTree();
            updateItemSelect();
            renderCanvas();
            drawGrid();
            setupEventListeners();
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        function setupEventListeners() {
            const canvas = document.getElementById('canvas');

            // Mouse events for drawing widgets
            canvas.addEventListener('mousedown', handleCanvasMouseDown);
            canvas.addEventListener('mousemove', handleCanvasMouseMove);
            canvas.addEventListener('mouseup', handleCanvasMouseUp);
            canvas.addEventListener('mouseleave', handleCanvasMouseUp);

            // Click outside to deselect
            canvas.addEventListener('click', (e) => {
                if (e.target === canvas || e.target.classList.contains('grid-overlay')) {
                    deselectWidget();
                }
            });

            // Tree section toggles
            document.querySelectorAll('.tree-section-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    if (e.target.classList.contains('add-btn')) return;
                    header.classList.toggle('collapsed');
                    const items = header.nextElementSibling;
                    items.style.display = header.classList.contains('collapsed') ? 'none' : 'block';
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyDown);
        }

        function handleKeyDown(e) {
            if (e.key === 'Delete' && selectedWidgetId) {
                showDeleteConfirm();
            }
            if (e.key === 'Escape') {
                deselectWidget();
                closeAllPopups();
            }
        }

        // ============================================
        // CANVAS DRAWING
        // ============================================

        function handleCanvasMouseDown(e) {
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Check if clicking on a widget
            const widget = e.target.closest('.widget');
            if (widget && !widget.classList.contains('layout-widget')) {
                handleWidgetClick(widget, e);
                return;
            }

            // If not in edit mode for current type, don't allow drawing
            if (currentMode === 'screen' && !currentItemId) return;
            if (currentMode === 'layout' && !currentItemId) return;

            // Start drawing new widget
            isDrawing = true;
            drawStart = snapToGrid(x, y);
            
            const drawingBox = document.getElementById('drawing-box');
            drawingBox.style.display = 'block';
            drawingBox.style.left = drawStart.x + 'px';
            drawingBox.style.top = drawStart.y + 'px';
            drawingBox.style.width = '0';
            drawingBox.style.height = '0';
        }

        function handleCanvasMouseMove(e) {
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Update status bar position
            const gridPos = pixelToGrid(x, y);
            document.getElementById('status-pos').textContent = `Pos: ${gridPos.col}, ${gridPos.row}`;

            if (isDrawing) {
                const current = snapToGrid(x, y);
                const drawingBox = document.getElementById('drawing-box');
                
                const left = Math.min(drawStart.x, current.x);
                const top = Math.min(drawStart.y, current.y);
                const width = Math.abs(current.x - drawStart.x);
                const height = Math.abs(current.y - drawStart.y);

                drawingBox.style.left = left + 'px';
                drawingBox.style.top = top + 'px';
                drawingBox.style.width = width + 'px';
                drawingBox.style.height = height + 'px';
            }

            if (isDragging && selectedWidgetId) {
                handleWidgetDrag(e);
            }

            if (isResizing && selectedWidgetId) {
                handleWidgetResize(e);
            }
        }

        function handleCanvasMouseUp(e) {
            if (isDrawing) {
                const canvas = document.getElementById('canvas');
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const end = snapToGrid(x, y);

                const left = Math.min(drawStart.x, end.x);
                const top = Math.min(drawStart.y, end.y);
                const width = Math.abs(end.x - drawStart.x);
                const height = Math.abs(end.y - drawStart.y);

                // Only create widget if it has minimum size
                if (width >= getCellWidth() && height >= getCellHeight()) {
                    createWidget(left, top, width, height);
                }

                const drawingBox = document.getElementById('drawing-box');
                drawingBox.style.display = 'none';
                isDrawing = false;
            }

            isDragging = false;
            isResizing = false;
        }

        // ============================================
        // GRID FUNCTIONS
        // ============================================

        function getCellWidth() {
            const canvas = document.getElementById('canvas');
            return canvas.offsetWidth / projectData.gridCols;
        }

        function getCellHeight() {
            const canvas = document.getElementById('canvas');
            return canvas.offsetHeight / projectData.gridRows;
        }

        function snapToGrid(x, y) {
            const cellW = getCellWidth();
            const cellH = getCellHeight();
            return {
                x: Math.round(x / cellW) * cellW,
                y: Math.round(y / cellH) * cellH
            };
        }

        function pixelToGrid(x, y) {
            const cellW = getCellWidth();
            const cellH = getCellHeight();
            return {
                col: Math.floor(x / cellW),
                row: Math.floor(y / cellH)
            };
        }

        function gridToPixel(col, row) {
            const cellW = getCellWidth();
            const cellH = getCellHeight();
            return {
                x: col * cellW,
                y: row * cellH
            };
        }

        function drawGrid() {
            const overlay = document.getElementById('grid-overlay');
            const canvas = document.getElementById('canvas');
            const width = canvas.offsetWidth;
            const height = canvas.offsetHeight;
            const cellW = getCellWidth();
            const cellH = getCellHeight();

            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`;

            // Draw vertical lines
            for (let i = 0; i <= projectData.gridCols; i++) {
                const x = i * cellW;
                const isMajor = i % 8 === 0;
                svg += `<line x1="${x}" y1="0" x2="${x}" y2="${height}" 
                        stroke="${isMajor ? 'var(--grid-line-major)' : 'var(--grid-line)'}" 
                        stroke-width="${isMajor ? 1 : 0.5}"/>`;
            }

            // Draw horizontal lines
            for (let i = 0; i <= projectData.gridRows; i++) {
                const y = i * cellH;
                const isMajor = i % 8 === 0;
                svg += `<line x1="0" y1="${y}" x2="${width}" y2="${y}" 
                        stroke="${isMajor ? 'var(--grid-line-major)' : 'var(--grid-line)'}" 
                        stroke-width="${isMajor ? 1 : 0.5}"/>`;
            }

            svg += '</svg>';
            overlay.innerHTML = svg;
        }

        function toggleGrid() {
            showGrid = !showGrid;
            const overlay = document.getElementById('grid-overlay');
            overlay.classList.toggle('hidden', !showGrid);
            document.getElementById('toggle-grid-btn').classList.toggle('active', showGrid);
        }

        function updateGridSize() {
            projectData.gridCols = parseInt(document.getElementById('grid-cols').value) || 64;
            projectData.gridRows = parseInt(document.getElementById('grid-rows').value) || 36;
            document.getElementById('status-grid').textContent = `Grid: ${projectData.gridCols}√ó${projectData.gridRows}`;
            drawGrid();
            renderCanvas();
        }

        // ============================================
        // WIDGET MANAGEMENT
        // ============================================

        function createWidget(x, y, width, height) {
            const gridPos = pixelToGrid(x, y);
            const gridSize = {
                cols: Math.round(width / getCellWidth()),
                rows: Math.round(height / getCellHeight())
            };

            const widget = {
                id: `widget_${++widgetIdCounter}`,
                name: `Widget ${widgetIdCounter}`,
                col: gridPos.col,
                row: gridPos.row,
                colSpan: gridSize.cols,
                rowSpan: gridSize.rows,
                type: 'placeholder'
            };

            // Add to current item
            if (currentMode === 'screen' && currentItemId) {
                projectData.screens[currentItemId].widgets.push(widget);
            } else if (currentMode === 'layout' && currentItemId) {
                projectData.layouts[currentItemId].widgets.push(widget);
            }

            renderCanvas();
            selectWidget(widget.id);
            updateComponentsList();
        }

        function renderCanvas() {
            const canvas = document.getElementById('canvas');
            
            // Remove existing widgets
            canvas.querySelectorAll('.widget').forEach(w => w.remove());

            // Get current item data
            let layoutWidgets = [];
            let screenWidgets = [];

            if (currentMode === 'screen' && currentItemId) {
                const screen = projectData.screens[currentItemId];
                if (screen) {
                    screenWidgets = screen.widgets || [];
                    if (screen.layoutId && projectData.layouts[screen.layoutId]) {
                        layoutWidgets = projectData.layouts[screen.layoutId].widgets || [];
                    }
                }
                document.getElementById('status-mode').textContent = `Mode: Edit Screen`;
            } else if (currentMode === 'layout' && currentItemId) {
                layoutWidgets = projectData.layouts[currentItemId]?.widgets || [];
                document.getElementById('status-mode').textContent = `Mode: Edit Layout`;
            }

            // Render layout widgets (non-editable in screen mode)
            layoutWidgets.forEach(w => {
                renderWidget(w, currentMode === 'screen');
            });

            // Render screen widgets
            screenWidgets.forEach(w => {
                renderWidget(w, false);
            });

            const totalWidgets = layoutWidgets.length + screenWidgets.length;
            document.getElementById('status-widgets').textContent = `Widgets: ${totalWidgets}`;
        }

        function renderWidget(widget, isLayoutWidget = false) {
            const canvas = document.getElementById('canvas');
            const pos = gridToPixel(widget.col, widget.row);
            const size = {
                width: widget.colSpan * getCellWidth(),
                height: widget.rowSpan * getCellHeight()
            };

            const el = document.createElement('div');
            el.className = `widget ${isLayoutWidget ? 'layout-widget' : ''} ${selectedWidgetId === widget.id ? 'selected' : ''}`;
            el.dataset.widgetId = widget.id;
            el.style.left = pos.x + 'px';
            el.style.top = pos.y + 'px';
            el.style.width = size.width + 'px';
            el.style.height = size.height + 'px';

            el.innerHTML = `
                <span class="widget-label">${widget.name}</span>
                ${!isLayoutWidget ? `
                <div class="widget-toolbar">
                    <button class="widget-tool-btn" onclick="showRenamePopup('${widget.id}')" title="Rename">‚úèÔ∏è</button>
                    <button class="widget-tool-btn" onclick="duplicateWidget('${widget.id}')" title="Duplicate">üìã</button>
                    <button class="widget-tool-btn danger" onclick="showDeleteConfirm('${widget.id}')" title="Delete">üóëÔ∏è</button>
                </div>
                <div class="confirm-popup" id="confirm-${widget.id}">
                    <div class="confirm-popup-text">Delete this widget?</div>
                    <div class="confirm-popup-btns">
                        <button class="confirm-btn yes" onclick="deleteWidget('${widget.id}')">Y</button>
                        <button class="confirm-btn no" onclick="hideDeleteConfirm('${widget.id}')">N</button>
                    </div>
                </div>
                <div class="rename-container" id="rename-${widget.id}">
                    <div class="rename-label">Rename Widget</div>
                    <input type="text" class="rename-input" id="rename-input-${widget.id}" value="${widget.name}" 
                           onkeydown="if(event.key==='Enter')saveRename('${widget.id}')">
                    <div class="rename-suggestions" id="rename-suggestions-${widget.id}"></div>
                    <div class="rename-btns">
                        <button class="rename-btn cancel" onclick="hideRenamePopup('${widget.id}')">Cancel</button>
                        <button class="rename-btn save" onclick="saveRename('${widget.id}')">Save</button>
                    </div>
                </div>
                <div class="resize-handle resize-handle-n ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-s ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-e ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-w ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-nw ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-ne ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-sw ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                <div class="resize-handle resize-handle-se ${selectedWidgetId === widget.id ? '' : 'hidden'}"></div>
                ` : ''}
            `;

            if (!isLayoutWidget) {
                // Add resize handle listeners
                el.querySelectorAll('.resize-handle').forEach(handle => {
                    handle.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        isResizing = true;
                        resizeDirection = handle.className.split(' ')[1].replace('resize-handle-', '');
                        selectWidget(widget.id);
                    });
                });
            }

            canvas.appendChild(el);
        }

        function handleWidgetClick(widgetEl, e) {
            const widgetId = widgetEl.dataset.widgetId;
            
            if (widgetEl.classList.contains('layout-widget')) {
                return; // Can't interact with layout widgets in screen mode
            }

            selectWidget(widgetId);

            // Start dragging
            isDragging = true;
            const rect = widgetEl.getBoundingClientRect();
            dragOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            e.stopPropagation();
        }

        function handleWidgetDrag(e) {
            const widget = findWidget(selectedWidgetId);
            if (!widget) return;

            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left - dragOffset.x;
            const y = e.clientY - rect.top - dragOffset.y;

            const snapped = snapToGrid(x, y);
            const gridPos = pixelToGrid(snapped.x, snapped.y);

            widget.col = Math.max(0, Math.min(gridPos.col, projectData.gridCols - widget.colSpan));
            widget.row = Math.max(0, Math.min(gridPos.row, projectData.gridRows - widget.rowSpan));

            renderCanvas();
        }

        function handleWidgetResize(e) {
            const widget = findWidget(selectedWidgetId);
            if (!widget) return;

            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const snapped = snapToGrid(x, y);
            const gridPos = pixelToGrid(snapped.x, snapped.y);

            const originalRight = widget.col + widget.colSpan;
            const originalBottom = widget.row + widget.rowSpan;

            switch (resizeDirection) {
                case 'e':
                    widget.colSpan = Math.max(1, gridPos.col - widget.col);
                    break;
                case 'w':
                    const newCol = Math.min(gridPos.col, originalRight - 1);
                    widget.colSpan = originalRight - newCol;
                    widget.col = newCol;
                    break;
                case 's':
                    widget.rowSpan = Math.max(1, gridPos.row - widget.row);
                    break;
                case 'n':
                    const newRow = Math.min(gridPos.row, originalBottom - 1);
                    widget.rowSpan = originalBottom - newRow;
                    widget.row = newRow;
                    break;
                case 'se':
                    widget.colSpan = Math.max(1, gridPos.col - widget.col);
                    widget.rowSpan = Math.max(1, gridPos.row - widget.row);
                    break;
                case 'sw':
                    const newColSW = Math.min(gridPos.col, originalRight - 1);
                    widget.colSpan = originalRight - newColSW;
                    widget.col = newColSW;
                    widget.rowSpan = Math.max(1, gridPos.row - widget.row);
                    break;
                case 'ne':
                    widget.colSpan = Math.max(1, gridPos.col - widget.col);
                    const newRowNE = Math.min(gridPos.row, originalBottom - 1);
                    widget.rowSpan = originalBottom - newRowNE;
                    widget.row = newRowNE;
                    break;
                case 'nw':
                    const newColNW = Math.min(gridPos.col, originalRight - 1);
                    widget.colSpan = originalRight - newColNW;
                    widget.col = newColNW;
                    const newRowNW = Math.min(gridPos.row, originalBottom - 1);
                    widget.rowSpan = originalBottom - newRowNW;
                    widget.row = newRowNW;
                    break;
            }

            renderCanvas();
        }

        function selectWidget(widgetId) {
            selectedWidgetId = widgetId;
            renderCanvas();
        }

        function deselectWidget() {
            selectedWidgetId = null;
            renderCanvas();
        }

        function findWidget(widgetId) {
            if (currentMode === 'screen' && currentItemId) {
                return projectData.screens[currentItemId]?.widgets.find(w => w.id === widgetId);
            } else if (currentMode === 'layout' && currentItemId) {
                return projectData.layouts[currentItemId]?.widgets.find(w => w.id === widgetId);
            }
            return null;
        }

        function findWidgetIndex(widgetId) {
            if (currentMode === 'screen' && currentItemId) {
                return projectData.screens[currentItemId]?.widgets.findIndex(w => w.id === widgetId);
            } else if (currentMode === 'layout' && currentItemId) {
                return projectData.layouts[currentItemId]?.widgets.findIndex(w => w.id === widgetId);
            }
            return -1;
        }

        // ============================================
        // WIDGET ACTIONS
        // ============================================

        function showDeleteConfirm(widgetId) {
            closeAllPopups();
            const popup = document.getElementById(`confirm-${widgetId}`);
            if (popup) popup.classList.add('show');
        }

        function hideDeleteConfirm(widgetId) {
            const popup = document.getElementById(`confirm-${widgetId}`);
            if (popup) popup.classList.remove('show');
        }

        function deleteWidget(widgetId) {
            const index = findWidgetIndex(widgetId);
            if (index === -1) return;

            if (currentMode === 'screen' && currentItemId) {
                projectData.screens[currentItemId].widgets.splice(index, 1);
            } else if (currentMode === 'layout' && currentItemId) {
                projectData.layouts[currentItemId].widgets.splice(index, 1);
            }

            selectedWidgetId = null;
            renderCanvas();
            updateComponentsList();
        }

        function showRenamePopup(widgetId) {
            closeAllPopups();
            const popup = document.getElementById(`rename-${widgetId}`);
            const input = document.getElementById(`rename-input-${widgetId}`);
            const suggestions = document.getElementById(`rename-suggestions-${widgetId}`);
            
            if (popup && input) {
                popup.classList.add('show');
                input.select();
                
                // Populate suggestions
                let html = '';
                Object.entries(projectData.components).forEach(([group, names]) => {
                    if (names.length > 0) {
                        html += `<div class="suggestion-group">
                            <div class="suggestion-group-title">${group}</div>
                            ${names.map(n => `<div class="suggestion-item" onclick="selectSuggestion('${widgetId}', '${n}')">${n}</div>`).join('')}
                        </div>`;
                    }
                });
                html += `<div class="suggestion-group">
                    <div class="suggestion-group-title">New</div>
                    <div class="suggestion-item" onclick="document.getElementById('rename-input-${widgetId}').focus()">+ Create new name</div>
                </div>`;
                suggestions.innerHTML = html;
            }
        }

        function hideRenamePopup(widgetId) {
            const popup = document.getElementById(`rename-${widgetId}`);
            if (popup) popup.classList.remove('show');
        }

        function selectSuggestion(widgetId, name) {
            document.getElementById(`rename-input-${widgetId}`).value = name;
        }

        function saveRename(widgetId) {
            const input = document.getElementById(`rename-input-${widgetId}`);
            if (!input) return;

            const widget = findWidget(widgetId);
            if (widget) {
                widget.name = input.value.trim() || widget.name;
                addToComponentsList(widget.name);
            }

            hideRenamePopup(widgetId);
            renderCanvas();
        }

        function duplicateWidget(widgetId) {
            const widget = findWidget(widgetId);
            if (!widget) return;

            const newWidget = {
                ...widget,
                id: `widget_${++widgetIdCounter}`,
                col: Math.min(widget.col + 2, projectData.gridCols - widget.colSpan),
                row: Math.min(widget.row + 2, projectData.gridRows - widget.rowSpan)
            };

            if (currentMode === 'screen' && currentItemId) {
                projectData.screens[currentItemId].widgets.push(newWidget);
            } else if (currentMode === 'layout' && currentItemId) {
                projectData.layouts[currentItemId].widgets.push(newWidget);
            }

            selectWidget(newWidget.id);
            renderCanvas();
        }

        function closeAllPopups() {
            document.querySelectorAll('.confirm-popup, .rename-container').forEach(p => {
                p.classList.remove('show');
            });
        }

        // ============================================
        // COMPONENT LIBRARY
        // ============================================

        function addToComponentsList(name) {
            const lowerName = name.toLowerCase();
            let group = 'other';

            if (lowerName.includes('header')) group = 'header';
            else if (lowerName.includes('footer')) group = 'footer';
            else if (lowerName.includes('nav')) group = 'navigation';
            else if (lowerName.includes('button') || lowerName.includes('btn')) group = 'button';
            else if (lowerName.includes('card')) group = 'card';

            if (!projectData.components[group].includes(name)) {
                projectData.components[group].push(name);
            }

            updateComponentsList();
        }

        function updateComponentsList() {
            // Collect all widget names from all screens and layouts
            const allNames = new Set();
            
            Object.values(projectData.screens).forEach(screen => {
                screen.widgets.forEach(w => allNames.add(w.name));
            });
            
            Object.values(projectData.layouts).forEach(layout => {
                layout.widgets.forEach(w => allNames.add(w.name));
            });

            // Reset and categorize
            projectData.components = {
                header: [],
                footer: [],
                navigation: [],
                button: [],
                card: [],
                other: []
            };

            allNames.forEach(name => {
                const lowerName = name.toLowerCase();
                if (lowerName.includes('header')) projectData.components.header.push(name);
                else if (lowerName.includes('footer')) projectData.components.footer.push(name);
                else if (lowerName.includes('nav')) projectData.components.navigation.push(name);
                else if (lowerName.includes('button') || lowerName.includes('btn')) projectData.components.button.push(name);
                else if (lowerName.includes('card')) projectData.components.card.push(name);
                else projectData.components.other.push(name);
            });

            renderComponentsTree();
        }

        function renderComponentsTree() {
            const tree = document.getElementById('components-tree');
            let html = '';

            Object.entries(projectData.components).forEach(([group, names]) => {
                if (names.length > 0) {
                    html += `<div style="margin-left: 8px; margin-bottom: 8px;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px;">${group}</div>
                        ${names.map(n => `<div class="tree-item" style="padding: 4px 8px; font-size: 12px;">${n}</div>`).join('')}
                    </div>`;
                }
            });

            tree.innerHTML = html || '<div style="padding: 8px; color: var(--text-muted); font-size: 12px;">No components yet</div>';
        }

        // ============================================
        // PROJECT TREE
        // ============================================

        function updateProjectTree() {
            const layoutsTree = document.getElementById('layouts-tree');
            const screensTree = document.getElementById('screens-tree');

            // Render layouts
            let layoutsHtml = '';
            Object.values(projectData.layouts).forEach(layout => {
                const isActive = currentMode === 'layout' && currentItemId === layout.id;
                layoutsHtml += `
                    <div class="tree-item ${isActive ? 'active' : ''}" onclick="selectLayout('${layout.id}')">
                        <span class="item-icon">üìê</span>
                        <span class="item-name">${layout.name}</span>
                        <div class="item-actions">
                            <button class="item-action-btn danger" onclick="event.stopPropagation(); deleteLayout('${layout.id}')" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            layoutsTree.innerHTML = layoutsHtml || '<div style="padding: 8px 12px; color: var(--text-muted); font-size: 12px;">No layouts</div>';

            // Render screens
            let screensHtml = '';
            Object.values(projectData.screens).forEach(screen => {
                const isActive = currentMode === 'screen' && currentItemId === screen.id;
                screensHtml += `
                    <div class="tree-item ${isActive ? 'active' : ''}" onclick="selectScreen('${screen.id}')">
                        <span class="item-icon">üì±</span>
                        <span class="item-name">${screen.name}</span>
                        <div class="item-actions">
                            <button class="item-action-btn" onclick="event.stopPropagation(); copyScreenJSON('${screen.id}')" title="Copy JSON">üìã</button>
                            <button class="item-action-btn danger" onclick="event.stopPropagation(); deleteScreen('${screen.id}')" title="Delete">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            screensTree.innerHTML = screensHtml || '<div style="padding: 8px 12px; color: var(--text-muted); font-size: 12px;">No screens</div>';

            updateItemSelect();
        }

        function updateItemSelect() {
            const select = document.getElementById('current-item-select');
            let html = '<option value="">-- Select --</option>';
            html += '<optgroup label="Layouts">';
            Object.values(projectData.layouts).forEach(layout => {
                html += `<option value="layout:${layout.id}" ${currentMode === 'layout' && currentItemId === layout.id ? 'selected' : ''}>${layout.name}</option>`;
            });
            html += '</optgroup>';
            html += '<optgroup label="Screens">';
            Object.values(projectData.screens).forEach(screen => {
                html += `<option value="screen:${screen.id}" ${currentMode === 'screen' && currentItemId === screen.id ? 'selected' : ''}>${screen.name}</option>`;
            });
            html += '</optgroup>';
            select.innerHTML = html;

            // Update layout select in new screen modal
            const layoutSelect = document.getElementById('new-screen-layout');
            let layoutHtml = '<option value="">-- No Layout (Default) --</option>';
            Object.values(projectData.layouts).forEach(layout => {
                layoutHtml += `<option value="${layout.id}">${layout.name}</option>`;
            });
            layoutSelect.innerHTML = layoutHtml;
        }

        function selectItem(value) {
            if (!value) return;
            const [type, id] = value.split(':');
            if (type === 'layout') {
                selectLayout(id);
            } else if (type === 'screen') {
                selectScreen(id);
            }
        }

        function selectLayout(layoutId) {
            currentMode = 'layout';
            currentItemId = layoutId;
            selectedWidgetId = null;
            updateProjectTree();
            renderCanvas();
        }

        function selectScreen(screenId) {
            currentMode = 'screen';
            currentItemId = screenId;
            selectedWidgetId = null;
            updateProjectTree();
            renderCanvas();
        }

        // ============================================
        // CREATE / DELETE ITEMS
        // ============================================

        function createNewLayout() {
            document.getElementById('new-layout-id').value = '';
            document.getElementById('new-layout-name').value = '';
            document.getElementById('new-layout-modal').classList.add('show');
        }

        function closeNewLayoutModal() {
            document.getElementById('new-layout-modal').classList.remove('show');
        }

        function saveNewLayout() {
            const id = document.getElementById('new-layout-id').value.trim() || `layout_${Date.now()}`;
            const name = document.getElementById('new-layout-name').value.trim() || 'New Layout';

            if (projectData.layouts[id]) {
                alert('Layout ID already exists!');
                return;
            }

            projectData.layouts[id] = {
                id,
                name,
                widgets: []
            };

            closeNewLayoutModal();
            selectLayout(id);
            updateProjectTree();
        }

        function deleteLayout(layoutId) {
            if (layoutId === 'default') {
                alert('Cannot delete default layout!');
                return;
            }

            if (!confirm(`Delete layout "${projectData.layouts[layoutId]?.name}"?`)) return;

            // Update screens that use this layout
            Object.values(projectData.screens).forEach(screen => {
                if (screen.layoutId === layoutId) {
                    screen.layoutId = 'default';
                }
            });

            delete projectData.layouts[layoutId];

            if (currentItemId === layoutId) {
                currentMode = 'screen';
                currentItemId = Object.keys(projectData.screens)[0] || null;
            }

            updateProjectTree();
            renderCanvas();
        }

        function createNewScreen() {
            document.getElementById('new-screen-id').value = '';
            document.getElementById('new-screen-name').value = '';
            document.getElementById('new-screen-layout').value = 'default';
            document.getElementById('new-screen-scroll').value = 'fixed';
            document.getElementById('new-screen-modal').classList.add('show');
        }

        function closeNewScreenModal() {
            document.getElementById('new-screen-modal').classList.remove('show');
        }

        function saveNewScreen() {
            const id = document.getElementById('new-screen-id').value.trim() || `screen_${Date.now()}`;
            const name = document.getElementById('new-screen-name').value.trim() || 'New Screen';
            const layoutId = document.getElementById('new-screen-layout').value || null;
            const scrollType = document.getElementById('new-screen-scroll').value;

            if (projectData.screens[id]) {
                alert('Screen ID already exists!');
                return;
            }

            projectData.screens[id] = {
                id,
                name,
                layoutId,
                scrollType,
                widgets: []
            };

            closeNewScreenModal();
            selectScreen(id);
            updateProjectTree();
        }

        function deleteScreen(screenId) {
            if (Object.keys(projectData.screens).length <= 1) {
                alert('Cannot delete the last screen!');
                return;
            }

            if (!confirm(`Delete screen "${projectData.screens[screenId]?.name}"?`)) return;

            delete projectData.screens[screenId];

            if (currentItemId === screenId) {
                currentItemId = Object.keys(projectData.screens)[0];
            }

            updateProjectTree();
            renderCanvas();
        }

        // ============================================
        // DEVICE & VIEW
        // ============================================

        function changeDevice(device) {
            projectData.device = device;
            const wrapper = document.getElementById('canvas-wrapper');
            wrapper.className = 'canvas-wrapper ' + device;

            if (device === 'custom') {
                // TODO: Add custom size input
            }

            setTimeout(() => {
                drawGrid();
                renderCanvas();
            }, 100);
        }

        function fitToScreen() {
            const container = document.getElementById('canvas-container');
            const wrapper = document.getElementById('canvas-wrapper');
            
            wrapper.classList.toggle('fit-screen');
            
            if (wrapper.classList.contains('fit-screen')) {
                const containerRect = container.getBoundingClientRect();
                const wrapperWidth = wrapper.offsetWidth;
                const wrapperHeight = wrapper.offsetHeight;
                
                const scaleX = (containerRect.width - 80) / wrapperWidth;
                const scaleY = (containerRect.height - 80) / wrapperHeight;
                const scale = Math.min(scaleX, scaleY, 1);
                
                wrapper.style.setProperty('--fit-scale', scale);
            }
        }

        // ============================================
        // IMPORT / EXPORT
        // ============================================

        function showImportModal() {
            document.getElementById('import-json').value = '';
            document.getElementById('import-file').value = '';
            document.getElementById('import-modal').classList.add('show');
        }

        function closeImportModal() {
            document.getElementById('import-modal').classList.remove('show');
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('import-json').value = e.target.result;
            };
            reader.readAsText(file);
        }

        function importJSON() {
            const json = document.getElementById('import-json').value.trim();
            const type = document.getElementById('import-type').value;

            if (!json) {
                alert('Please enter JSON data!');
                return;
            }

            try {
                const data = JSON.parse(json);

                if (type === 'project') {
                    // Import full project
                    if (data.layouts) projectData.layouts = data.layouts;
                    if (data.screens) projectData.screens = data.screens;
                    if (data.gridCols) projectData.gridCols = data.gridCols;
                    if (data.gridRows) projectData.gridRows = data.gridRows;
                    
                    document.getElementById('grid-cols').value = projectData.gridCols;
                    document.getElementById('grid-rows').value = projectData.gridRows;
                    
                    currentItemId = Object.keys(projectData.screens)[0] || null;
                    currentMode = 'screen';
                } else if (type === 'screen') {
                    const id = data.id || `screen_${Date.now()}`;
                    projectData.screens[id] = data;
                    selectScreen(id);
                } else if (type === 'layout') {
                    const id = data.id || `layout_${Date.now()}`;
                    projectData.layouts[id] = data;
                    selectLayout(id);
                }

                closeImportModal();
                updateProjectTree();
                updateComponentsList();
                drawGrid();
                renderCanvas();

            } catch (e) {
                alert('Invalid JSON: ' + e.message);
            }
        }

        function copyCurrentJSON() {
            let data;
            if (currentMode === 'screen' && currentItemId) {
                data = projectData.screens[currentItemId];
            } else if (currentMode === 'layout' && currentItemId) {
                data = projectData.layouts[currentItemId];
            }

            if (data) {
                const json = JSON.stringify(data, null, 2);
                navigator.clipboard.writeText(json).then(() => {
                    alert('JSON copied to clipboard!');
                });
            }
        }

        function copyScreenJSON(screenId) {
            const data = projectData.screens[screenId];
            if (data) {
                const json = JSON.stringify(data, null, 2);
                navigator.clipboard.writeText(json).then(() => {
                    alert('Screen JSON copied to clipboard!');
                });
            }
        }

        function exportProject() {
            const exportData = {
                name: projectData.name,
                version: "1.0.0",
                gridCols: projectData.gridCols,
                gridRows: projectData.gridRows,
                device: projectData.device,
                layouts: projectData.layouts,
                screens: projectData.screens,
                exportedAt: new Date().toISOString()
            };

            const json = JSON.stringify(exportData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectData.name.replace(/\s+/g, '-').toLowerCase()}-ui-placeholders.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize
        init();
    </script>
</body>
</html>
